<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Stellantis - Cloud Sync</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
    
    <style>
        :root { --primary: #003366; --secondary: #f4f4f4; --success: #28a745; --warning: #ffc107; --danger: #dc3545; }
        body { font-family: sans-serif; background: var(--secondary); padding: 20px; }
        .kpi-container { display: flex; gap: 15px; margin-bottom: 20px; }
        .kpi-card { background: white; padding: 20px; border-radius: 8px; flex: 1; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; }
        th, td { padding: 12px; border-bottom: 1px solid #ddd; text-align: left; }
        th { background: var(--primary); color: white; }
        .progress-bg { background: #eee; height: 10px; border-radius: 5px; width: 80px; }
        .btn { padding: 8px 12px; border: none; border-radius: 4px; cursor: pointer; color: white; font-weight: bold; }
        .btn-add { background: var(--success); margin-bottom: 15px; }
        .loading { color: var(--primary); font-weight: bold; }
    </style>
</head>
<body>

    <div style="display: flex; justify-content: space-between;">
        <h1>Dashboard Ejecutivo (Nube)</h1>
        <p id="status-cloud" class="loading">Sincronizando con Firebase...</p>
    </div>

    <div class="kpi-container" id="kpis">
        <div class="kpi-card"> <h2 id="kpi-total">0</h2> <small>TOTAL</small> </div>
        <div class="kpi-card"> <h2 id="kpi-avg">0%</h2> <small>AVANCE GLOBAL</small> </div>
        <div class="kpi-card"> <h2 id="kpi-ok" style="color:var(--success)">0</h2> <small>COMPLETOS</small> </div>
    </div>

    <button class="btn btn-add" onclick="addRow()">+ Agregar Nuevo Acuerdo</button>

    <table>
        <thead>
            <tr>
                <th>Área</th>
                <th>Tema</th>
                <th>Acción</th>
                <th>Responsable</th>
                <th>Avance</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody id="table-body"></tbody>
    </table>

    <script>
        // --- CONFIGURACIÓN DE FIREBASE ---
       // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyCsMH4Zggn5XcgHJNai7h-mtmTbAbTLP1o",
  authDomain: "dashboard-stellantis-c34d5.firebaseapp.com",
  projectId: "dashboard-stellantis-c34d5",
  storageBucket: "dashboard-stellantis-c34d5.firebasestorage.app",
  messagingSenderId: "938441957804",
  appId: "1:938441957804:web:c729cea65c7eebe7275a09",
  measurementId: "G-PP4NCWDT15"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);

        // --- LÓGICA DEL DASHBOARD ---

        // Escuchar cambios en tiempo real
        db.collection(collectionName).orderBy("area").onSnapshot((snapshot) => {
            const data = [];
            snapshot.forEach(doc => data.push({ id: doc.id, ...doc.data() }));
            renderTable(data);
            document.getElementById('status-cloud').innerText = "☁ Conectado a la Nube";
        });

        function renderTable(data) {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = '';
            let totalAvance = 0;
            let completos = 0;

            data.forEach(item => {
                totalAvance += parseInt(item.avance);
                if(item.avance >= 100) completos++;

                tbody.innerHTML += `
                    <tr>
                        <td contenteditable="true" onblur="updateField('${item.id}', 'area', this.innerText)">${item.area}</td>
                        <td contenteditable="true" onblur="updateField('${item.id}', 'tema', this.innerText)">${item.tema}</td>
                        <td contenteditable="true" onblur="updateField('${item.id}', 'accion', this.innerText)">${item.accion}</td>
                        <td contenteditable="true" onblur="updateField('${item.id}', 'resp', this.innerText)">${item.resp}</td>
                        <td>
                            <input type="number" value="${item.avance}" style="width:50px" 
                                   onchange="updateField('${item.id}', 'avance', this.value)"> %
                        </td>
                        <td>
                            <button class="btn" style="background:var(--danger)" onclick="deleteDoc('${item.id}')">Eliminar</button>
                        </td>
                    </tr>
                `;
            });

            // Actualizar KPIs
            document.getElementById('kpi-total').innerText = data.length;
            document.getElementById('kpi-avg').innerText = data.length > 0 ? Math.round(totalAvance/data.length) + '%' : '0%';
            document.getElementById('kpi-ok').innerText = completos;
        }

        // Funciones de Base de Datos
        async function updateField(id, field, value) {
            await db.collection(collectionName).doc(id).update({ [field]: value });
        }

        async function addRow() {
            await db.collection(collectionName).add({
                area: "Nueva Área",
                tema: "Nuevo Tema",
                accion: "Nueva Acción",
                resp: "Responsable",
                avance: 0
            });
        }

        async function deleteDoc(id) {
            if(confirm("¿Borrar este acuerdo?")) {
                await db.collection(collectionName).doc(id).delete();
            }
        }
    </script>
</body>
</html>
